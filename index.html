<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mey - Expense Tracker (Final Complete)</title>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* --- 1. FIGMA EXACT DESIGN TOKENS --- */
        :root {
            /* Backgrounds */
            --bg-main: #FFFDE7;       
            --bg-login: #FFEFCB;      
            --bg-register: #CBE6C0;   
            --bg-scan-area: #7988A2;  
            --bg-item-exp: #E9DA9C;   
            --bg-blue-box: #D1E5F4;   
            --bg-chat-bubble: #E2E8F0;
            
            /* Components */
            --bg-card: #FFFFFF;
            --nav-bg: #FFFFFF;
            
            /* Buttons & UI */
            --btn-blue: #CDEDFF;
            --btn-confirm: #3B82F6;   
            --btn-grey: #F3F4F6;      
            --c-darkblue: #4B5A76; 
            
            /* Texts & Borders */
            --text-main: #131211;
            --text-sub: #68583E;
            --border-solid: 1px solid #131211; 
            
            /* Chart Colors */
            --c-bar-1: #F06A6A; /* ‡πÅ‡∏î‡∏á */
            --c-bar-2: #F6D365; /* ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á */
            --c-bar-3: #E58787; /* ‡πÅ‡∏î‡∏á‡∏≠‡∏°‡∏ä‡∏°‡∏û‡∏π */
            --c-bar-4: #95D58C; /* ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß */
            --c-bar-5: #F0B87A; /* ‡∏™‡πâ‡∏° */
            --c-bar-6: #6FA2F2; /* ‡∏ü‡πâ‡∏≤ */
            --c-bar-7: #B478E2; /* ‡∏°‡πà‡∏ß‡∏á */
        }

        /* --- DARK MODE OVERRIDES --- */
        #app-frame.dark-mode {
            --bg-main: #1A202C;
            --bg-login: #2D3748;
            --bg-register: #38A169; /* ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡πÄ‡∏Ç‡πâ‡∏°‡∏Ç‡∏∂‡πâ‡∏ô‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏°‡∏∑‡∏î */
            --bg-item-exp: #4A5568;
            --bg-blue-box: #2B6CB0;
            --bg-scan-area: #2D3748;
            
            --bg-card: #2D3748;
            --nav-bg: #1A202C;
            
            --btn-blue: #4A5568;
            --btn-grey: #4A5568;
            
            --text-main: #F7FAFC;
            --text-sub: #A0AEC0;
            --border-solid: 1px solid #4A5568;
        }

        /* ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏™‡∏µ‡πÉ‡∏ô Dark Mode ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏û‡∏ß‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡∏à‡∏∞ hardcode ‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß‡πÑ‡∏ß‡πâ */
        #app-frame.dark-mode .card-white,
        #app-frame.dark-mode .input-box,
        #app-frame.dark-mode .popup-box,
        #app-frame.dark-mode .auth-card {
            background-color: var(--bg-card) !important;
            color: var(--text-main);
            border: var(--border-solid);
        }
        #app-frame.dark-mode #page-login { background-color: var(--bg-main) !important; }
        #app-frame.dark-mode .btn-cancel { background-color: transparent; }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            margin: 0; padding: 0; font-family: 'Prompt', sans-serif;
            background-color: #111827; height: 100vh;
            display: flex; justify-content: center; align-items: center; color: var(--text-main);
        }

        #app-frame {
            width: 375px; height: 812px; background-color: var(--bg-main);
            border-radius: 40px; box-shadow: 0 10px 50px rgba(0,0,0,0.5);
            position: relative; overflow: hidden; display: flex; flex-direction: column;
            transition: background-color 0.3s ease;
        }

        /* --- 2. PAGE SYSTEM --- */
        .page {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            padding: 20px; padding-top: 50px; padding-bottom: 90px;
            overflow-y: auto; background-color: var(--bg-main);
            display: none; flex-direction: column;
            opacity: 0; transform: scale(0.98) translateY(10px);
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }
        
        .page.active { display: flex; opacity: 1; transform: scale(1) translateY(0); z-index: 10; }
        .page::-webkit-scrollbar { display: none; }

        .notch {
            position: absolute; top: 0; left: 50%; transform: translateX(-50%);
            width: 140px; height: 25px; background-color: #1A202C;
            border-radius: 0 0 16px 16px; z-index: 1001;
        }

        .status-bar {
            position: absolute; top: 0; left: 0; width: 100%; height: 44px;
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 20px; font-size: 14px; font-weight: 600; color: var(--text-main); z-index: 1000; pointer-events: none;
        }

        .header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; }
        .header h2 { margin: 0; font-size: 18px; font-weight: 600; display: flex; align-items: center; color: var(--text-main);}
        .back-btn { font-size: 20px; color: var(--text-main); cursor: pointer; border: none; background: none; margin-right: 10px; transition: 0.2s;}
        
        .clickable { transition: transform 0.1s cubic-bezier(0.4, 0, 0.2, 1), filter 0.1s; cursor: pointer; }
        .clickable:active { transform: scale(0.94); filter: brightness(0.9); }

        /* --- 3. COMPONENTS --- */
        .auth-card { padding: 0 20px; height: 100%; display: flex; flex-direction: column; }
        .auth-tabs { display: flex; margin-top: 20px;}
        .tab { flex: 1; padding: 12px; text-align: center; font-weight: 500; font-size: 14px; border-radius: 12px 12px 0 0; transition: background 0.3s;}
        .auth-content { background: var(--bg-login); padding: 30px 20px; border-radius: 0 0 12px 12px; display: flex; flex-direction: column; border-top-right-radius: 12px;}
        
        .auth-input, .input-box { 
            width: 100%; padding: 14px 15px; border-radius: 8px; font-family: 'Prompt', sans-serif; 
            outline: none; font-size: 15px; color: var(--text-main); 
            display: block; box-sizing: border-box; text-align: left;
            background: var(--bg-card); border: var(--border-solid);
        }
        .auth-input { border: none; margin-bottom: 15px; background: var(--bg-card); }
        .input-box { margin-bottom: 15px; }
        
        input[type="number"]::-webkit-inner-spin-button, 
        input[type="number"]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        input[type="number"] { -moz-appearance: textfield; }

        .btn { padding: 12px 25px; border-radius: 12px; font-family: 'Prompt'; font-weight: 600; font-size: 14px; text-align: center; border: none; cursor: pointer;}
        .btn-blue { background: var(--btn-blue); color: var(--text-main); width: 150px; margin: 20px auto 0; display: block; border: var(--border-solid); }
        
        .card-transparent { padding: 10px 20px; margin-bottom: 15px; position: relative;}
        .card-white { background: var(--bg-card); border: var(--border-solid); border-radius: 12px; position: relative; }

        /* Home */
        .home-actions { display: flex; gap: 15px; margin-bottom: 30px; justify-content: space-between; padding: 0 5px;}
        .action-btn { 
            background: #C4D9F0; border: var(--border-solid); border-radius: 12px; flex: 1; aspect-ratio: 1; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            font-size: 12px; font-weight: 500; color: #131211; box-shadow: 2px 4px 8px rgba(0,0,0,0.15); 
        }
        #app-frame.dark-mode .action-btn { background: var(--bg-blue-box); color: var(--text-main); }
        .action-btn-middle { transform: scale(1.15); z-index: 1; }
        
        /* Gauge */
        .gauge-wrapper { width: 220px; height: 220px; margin: 0 auto; position: relative; }
        .gauge-ring { width: 100%; height: 100%; border-radius: 50%; background: conic-gradient(#8AC48A var(--percent, 42.8%), var(--bg-register) 0); display: flex; justify-content: center; align-items: center; border: var(--border-solid); transition: background 1s ease-out; }
        .gauge-inner { width: 150px; height: 150px; background: var(--bg-main); border-radius: 50%; display: flex; flex-direction: column; justify-content: center; align-items: center; border: var(--border-solid); transition: background 0.3s; padding: 10px; box-sizing: border-box;}
        .gauge-inner h1 { margin: 0; font-size: 26px; font-weight: 700; line-height: 1.2; text-align: center;}
        .gauge-inner span { font-size: 18px; font-weight: 600; margin-top: 5px; }

        /* History & Summary */
        .history-item { display: flex; justify-content: space-between; align-items: center; padding: 15px 20px; border-radius: 12px; margin-bottom: 10px; font-size: 14px; font-weight: 500; border: var(--border-solid); color: var(--text-main); transition: 0.2s;}
        .item-exp { background: var(--bg-item-exp); }
        .item-inc { background: var(--bg-register); }

        .summary-box { background: var(--bg-blue-box); border-radius: 12px; padding: 15px 20px; border: var(--border-solid); position: relative; margin-bottom: 15px; box-shadow: 2px 2px 0px rgba(0,0,0,0.1);}
        .chart-container { display: flex; align-items: flex-end; justify-content: space-around; height: 150px; padding-top: 20px; border-left: 1px solid var(--text-main); border-bottom: 1px solid var(--text-main); padding-left: 5px; margin-top: 10px;}
        .bar-group { display: flex; flex-direction: column; align-items: center; width: 12%; height: 100%; justify-content: flex-end; }
        .bar { width: 100%; position: relative; transition: height 1s cubic-bezier(0.175, 0.885, 0.32, 1.275); height: 0; border-radius: 2px 2px 0 0;}
        .bar-label { font-size: 10px; margin-top: 5px; color: var(--text-main); font-weight: 600;}

        .stat-box-container { display: flex; gap: 15px; margin-top: 15px; }
        .stat-box { flex: 1; background: var(--bg-main); border-radius: 12px; padding: 15px; text-align: center; border: var(--border-solid); }
        .stat-value-box { border-radius: 8px; padding: 10px; margin-top: 5px; display: flex; justify-content: center; align-items: center;}
        .stat-text-small { font-size: 9px; color: var(--text-sub); text-decoration: underline; margin-top: 5px; display: block; cursor: pointer;}

        /* --- 4. BOTTOM NAV --- */
        .bottom-nav {
            position: absolute; bottom: 0; left: 0; width: 100%; height: 75px;
            background: var(--nav-bg); border-top: var(--border-solid); 
            display: flex; justify-content: space-around; align-items: center; 
            padding: 0 10px; z-index: 100; transition: background-color 0.3s ease;
        }
        .nav-item {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            color: #9E9E9E; font-size: 11px; font-weight: 500; cursor: pointer; 
            width: 70px; height: 55px; border-radius: 16px; border: 2px solid transparent; transition: all 0.2s;
        }
        .nav-item i { font-size: 24px; margin-bottom: 3px; }
        .nav-item.active-nav { color: var(--text-main); font-weight: 600; }
        .nav-center { display: flex; flex-direction: column; align-items: center; justify-content: center; width: 70px; height: 60px; cursor: pointer; color: #9E9E9E; font-size: 11px; font-weight: 500; border-radius: 16px; border: 2px solid transparent; transition: all 0.2s; }
        .nav-center.scan-mode { background: var(--bg-register); border: var(--border-solid); color: var(--text-main); transform: translateY(-2px);}

        /* --- 5. POPUPS --- */
        .popup-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); backdrop-filter: blur(2px); z-index: 2000; display: none; justify-content: center; align-items: center; }
        .popup-box { background: var(--bg-card); width: 80%; padding: 30px 20px; border-radius: 20px; text-align: center; position: relative; box-shadow: 0 10px 40px rgba(0,0,0,0.15); animation: popUpAnim 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); border: var(--border-solid);}
        .popup-btn-wrap { display: flex; gap: 10px; margin-top: 25px;}
        .btn-cancel { flex: 1; padding: 12px; border-radius: 10px; font-family: 'Prompt'; font-weight: 600; font-size: 14px; background: var(--bg-card); color: var(--text-main); border: 2px solid var(--text-sub); cursor: pointer; display: flex; justify-content: center; align-items: center;}
        .btn-confirm { flex: 1; padding: 12px; border-radius: 10px; font-family: 'Prompt'; font-weight: 600; font-size: 14px; background: var(--btn-confirm); color: white; border: none; cursor: pointer; display: flex; justify-content: center; align-items: center;}
        
        @keyframes popUpAnim { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        
        .scan-line { width: 100%; height: 2px; background: white; position: absolute; top: 50%; left: 0; box-shadow: 0 0 10px white, 0 0 20px white; animation: scanMove 2.5s infinite ease-in-out; pointer-events: none; }
        @keyframes scanMove { 0% { top: 15%; opacity: 0;} 10% {opacity: 1;} 90% {opacity: 1;} 100% { top: 85%; opacity: 0;} }
        .scan-loading-text { position: absolute; width: 100%; text-align: center; top: 50%; transform: translateY(-50%); color: white; font-size: 16px; font-weight: 600; display: none; z-index: 10; }
        .confetti { position: absolute; width: 8px; height: 8px; background-color: #f00; opacity: 0; z-index: 1500; animation: fall 1.5s ease-out forwards; }
        @keyframes fall { 0% { opacity: 1; transform: translateY(0) rotate(0deg); } 100% { opacity: 0; transform: translateY(200px) rotate(360deg); } }
        
        /* --- 6. SIDEBAR MENU --- */
        .sidebar-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); z-index: 1500; display: none; opacity: 0;
            transition: opacity 0.3s ease; backdrop-filter: blur(2px);
        }
        .sidebar {
            position: absolute; top: 0; left: -280px; width: 280px; height: 100%;
            background: var(--bg-main); z-index: 1600; display: flex; flex-direction: column;
            transition: left 0.3s cubic-bezier(0.4, 0, 0.2, 1); border-right: var(--border-solid);
            box-shadow: 5px 0 15px rgba(0,0,0,0.15); overflow-y: auto;
        }
        .sidebar.open { left: 0; }
        
        .sidebar-profile { padding: 60px 30px 20px; }
        .sidebar-profile img { width: 80px; height: 80px; border-radius: 50%; border: var(--border-solid); object-fit: cover; margin-bottom: 20px; background: white;}
        .sidebar-profile .name { font-size: 18px; font-weight: 700; color: var(--text-main); }
        
        .menu-item-container { padding: 0 30px; }
        .menu-item {
            display: flex; align-items: center; justify-content: space-between;
            padding: 20px 0; font-size: 16px; font-weight: 700; color: var(--text-main);
            cursor: pointer; border-bottom: 1px solid var(--text-sub);
        }
        .menu-item:last-child { border-bottom: none; }
        .menu-item-left { display: flex; align-items: center; gap: 20px; }
        .menu-item-left i { font-size: 22px; width: 26px; text-align: center; }
        .menu-item-arrow { font-size: 16px; font-weight: bold; }

        /* --- 7. SETTINGS PAGE ELEMENTS --- */
        .toggle-switch {
            position: relative; width: 50px; height: 26px;
            background-color: #CBD5E1; border-radius: 13px;
            cursor: pointer; transition: 0.3s; border: 1px solid #94A3B8;
        }
        .toggle-switch::after {
            content: ''; position: absolute; top: 2px; left: 2px;
            width: 20px; height: 20px; background-color: white;
            border-radius: 50%; transition: 0.3s; box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .toggle-switch.active { background-color: var(--c-bar-4); border-color: var(--text-main); }
        .toggle-switch.active::after { transform: translateX(24px); }
        
        .setting-row {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px 0; border-bottom: 1px solid var(--text-sub);
        }
        .setting-row:last-child { border-bottom: none; }
    </style>
</head>
<body>

    <div id="app-frame">
        <div class="notch"></div>
        <div class="status-bar" id="top-status-bar">
            <span>08:46</span>
            <div><i class="fas fa-signal"></i> <i class="fas fa-wifi"></i> <i class="fas fa-battery-three-quarters"></i></div>
        </div>

        <section id="page-login" class="page active">
            <div class="auth-card" style="border: none; box-shadow: none;">
                <div style="text-align: center; margin-top: 40px; margin-bottom: 30px;">
                    <img id="app-logo" src="1.jpg" style="width: 80px; height: 80px; margin-bottom: 10px; border-radius: 50%; object-fit: cover; border: var(--border-solid);">
                    <h1 style="font-size: 28px; margin: 0; font-weight: 700;">Mey Tracker</h1>
                </div>
                <div class="auth-tabs">
                    <div class="tab tab-login clickable" id="tab-login-btn" style="background: var(--bg-login); opacity: 1;" onclick="goToAuth('login')">Login</div>
                    <div class="tab tab-register clickable" id="tab-register-btn" style="background: var(--bg-register); opacity: 0.6;" onclick="goToAuth('register')">Register</div>
                </div>
                <div class="auth-content" id="auth-box" style="background: var(--bg-login); border: none;">
                    <div id="form-login">
                        <div class="auth-label">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (Username/Name):</div>
                        <input type="text" class="auth-input" value="Maleeya">
                        <div class="auth-label">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô:</div>
                        <div style="position: relative;">
                            <input type="password" class="auth-input" value="123456">
                            <i class="fas fa-eye-slash" style="position: absolute; right: 15px; top: 12px; color: #888;"></i>
                        </div>
                        <div style="text-align: right; font-size: 10px; margin-top: -10px; text-decoration: underline;" class="clickable">‡∏•‡∏∑‡∏°‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</div>
                        <button class="btn btn-blue clickable" onclick="goToPage('page-home')">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
                    </div>
                    <div id="form-register" style="display: none;">
                        <div class="auth-label">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (Username/Name):</div>
                        <input type="text" class="auth-input">
                        <div class="auth-label">‡∏≠‡∏µ‡πÄ‡∏°‡∏• (Email):</div>
                        <input type="email" class="auth-input">
                        <div class="auth-label">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô:</div>
                        <input type="password" class="auth-input">
                    <button class="btn btn-blue clickable" onclick="goToAuth('login')" style="background: var(--bg-register); color: black; margin: 20px auto 0; display: block; width: 150px;">‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</button>
                </div>
            </div>
        </div>
    </section>

    <section id="page-home" class="page">
        <div class="header" style="margin-top: 10px; margin-bottom: 10px;">
            <div style="display: flex; align-items: center; font-size: 22px; font-weight: 600;">
                <i class="fas fa-bars clickable" style="margin-right: 15px;" onclick="openSidebar()"></i> Home
            </div>
            <i class="far fa-bell clickable" style="font-size: 22px;"></i>
        </div>

        <div style="display: flex; align-items: center; margin-bottom: 20px;">
                <img class="user-avatar" src="" style="width: 45px; height: 45px; border-radius: 50%; border: var(--border-solid); background: white; margin-right: 15px; object-fit: cover;">
                <span style="font-weight: 600; font-size: 16px;">Maleeya</span>
            </div>

            <div class="card-white" id="home-mascot-card" style="padding: 25px 20px; margin-bottom: 30px; text-align: center; box-shadow: 2px 4px 10px rgba(0,0,0,0.1);">
                <p id="mey-home-msg" style="margin: 0; font-size: 14px; font-weight: 500; text-align: center;">‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ ‡πÄ‡∏£‡∏≤‡πÄ‡∏°‡∏¢‡πå‡∏ô‡∏∞ <br> ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏≠‡∏≠‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á</p>
                <img id="may-mascot-home" src="1.jpg" style="width: 90px; height: 110px; position: absolute; right: 5px; bottom: 0px; z-index: 5; object-fit: contain;">
            </div>

            <div class="home-actions">
                <div class="action-btn clickable" onclick="goToPage('page-history')">
                    <i class="far fa-clock" style="font-size: 24px; margin-bottom: 8px;"></i>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥
                </div>
                <div class="action-btn action-btn-middle clickable" onclick="goToPage('page-add')">
                    <i class="fas fa-dollar-sign" style="font-size: 28px; margin-bottom: 8px;"></i>‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î
                </div>
                <div class="action-btn clickable" onclick="goToPage('page-summary')">
                    <i class="fas fa-chart-simple" style="font-size: 24px; margin-bottom: 8px;"></i>‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•
                </div>
            </div>

            <div class="gauge-wrapper clickable" onclick="goToPage('page-summary')" style="margin-top: 15px;">
                <div class="gauge-ring" id="home-gauge">
                    <div class="gauge-inner">
                        <h1 id="txt-balance-display"><span id="txt-balance">214</span> / <span id="txt-budget">500</span></h1>
                        <span style="color: var(--text-main);">‡∏ö‡∏≤‡∏ó</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- === ‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Settings (‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà) === -->
        <section id="page-settings" class="page">
            <div class="header">
                <h2><button class="back-btn clickable" onclick="goToPage('page-home')"><i class="fas fa-arrow-left"></i></button> Settings</h2>
            </div>

            <div class="auth-label" style="font-size: 16px; margin-top: 10px; font-weight: 600;">‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•</div>
            <div class="card-white" style="padding: 10px 20px; margin-top: 10px;">
                <div class="setting-row">
                    <div>
                        <div style="font-weight: 600; font-size: 14px;">‡πÇ‡∏´‡∏°‡∏î‡∏Å‡∏•‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô (Dark Mode)</div>
                        <div style="font-size: 11px; color: var(--text-sub);">‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ò‡∏µ‡∏°‡πÅ‡∏≠‡∏õ‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡∏°‡∏∑‡∏î‡∏ñ‡∏ô‡∏≠‡∏°‡∏™‡∏≤‡∏¢‡∏ï‡∏≤</div>
                    </div>
                    <div class="toggle-switch" id="toggle-dark-mode" onclick="toggleTheme()"></div>
                </div>
            </div>

            <div class="auth-label" style="font-size: 16px; margin-top: 25px; font-weight: 600;">‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</div>
            <div class="card-white" style="padding: 10px 20px; margin-top: 10px;">
                <div class="setting-row">
                    <div>
                        <div style="font-weight: 600; font-size: 14px;">‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</div>
                        <div style="font-size: 11px; color: var(--text-sub);">‡πÉ‡∏´‡πâ‡πÄ‡∏°‡∏¢‡πå‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏∏‡∏Å‡πÄ‡∏¢‡πá‡∏ô</div>
                    </div>
                    <div class="toggle-switch active" onclick="this.classList.toggle('active'); vibrate(20);"></div>
                </div>
                <div class="setting-row">
                    <div>
                        <div style="font-weight: 600; font-size: 14px;">‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì</div>
                        <div style="font-size: 11px; color: var(--text-sub);">‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡πÄ‡∏á‡∏¥‡∏ô‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Å‡∏¥‡∏ô‡∏á‡∏ö</div>
                    </div>
                    <div class="toggle-switch active" onclick="this.classList.toggle('active'); vibrate(20);"></div>
                </div>
            </div>

            <div class="auth-label" style="font-size: 16px; margin-top: 25px; font-weight: 600;">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>
            <div class="card-white" style="padding: 10px 20px; margin-top: 10px;">
                <div class="setting-row clickable" onclick="showPopup('popup-reset-data')">
                    <div>
                        <div style="font-weight: 600; font-size: 14px; color: #EF4444;">‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                        <div style="font-size: 11px; color: var(--text-sub);">‡∏•‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡∏∞‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</div>
                    </div>
                    <i class="fas fa-chevron-right" style="color: var(--text-sub);"></i>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 30px; font-size: 10px; color: var(--text-sub);">
                Mey Tracker Version 1.0.0
            </div>
        </section>

        <!-- ‡∏´‡∏ô‡πâ‡∏≤‡∏≠‡∏∑‡πà‡∏ô‡πÜ -->
        <section id="page-summary" class="page">
            <div class="header">
                <h2><button class="back-btn clickable" onclick="goToPage('page-home')"><i class="fas fa-arrow-left"></i></button> ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•</h2>
            </div>
            
            <div class="summary-box" style="text-align: center; padding-top: 20px; padding-bottom: 20px;">
                <div style="font-size: 16px; font-weight: 600;">‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏£‡∏ß‡∏°</div>
                <div style="font-size: 32px; font-weight: 700;"><span id="txt-summary-bal">230</span> ‡∏ö‡∏≤‡∏ó</div>
                <img class="user-avatar" src="" style="width: 65px; height: 65px; border-radius: 50%; position: absolute; right: -10px; bottom: -10px; border: var(--border-solid); background: white; object-fit: cover;">
            </div>
            
            <div class="summary-box" style="padding-bottom: 10px;">
                <div style="font-weight: 600; font-size: 16px; margin-bottom: 15px;">‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢</div>
                <select class="input-box" style="margin-bottom: 10px; border-radius: 8px; font-family: 'Prompt'; padding: 8px 12px; font-size: 14px; background: var(--bg-card);"><option>‡∏£‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</option></select>
                <div class="chart-container" id="chart-area"></div>
            </div>

            <div style="background: var(--c-darkblue); border-radius: 12px; padding: 15px 20px; color: white; border: var(--border-solid);">
                <div style="text-align: center; margin-bottom: 10px; font-weight: 500; font-size: 12px;">‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ</div>
                <div style="display: flex; height: 16px; border-radius: 8px; overflow: hidden; margin-bottom: 10px; border: 1px solid #131211;">
                    <div style="background: var(--c-bar-6); width: 20%;"></div>
                    <div style="background: var(--c-bar-4); width: 45%;"></div>
                    <div style="background: var(--c-bar-2); width: 20%;"></div>
                    <div style="background: var(--c-bar-1); width: 15%;"></div>
                </div>
                <div style="display: flex; justify-content: space-between; font-size: 10px; font-weight: 400; opacity: 0.8;">
                    <span>‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤</span>
                    <span>‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô</span>
                    <span>‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô</span>
                    <span>‡∏ü‡∏∏‡πà‡∏°‡πÄ‡∏ü‡∏∑‡∏≠‡∏¢</span>
                </div>
            </div>

            <div class="stat-box-container">
                <div class="stat-box">
                    <div style="font-weight: 600; font-size: 14px;">‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î</div>
                    <div class="stat-value-box" style="background: #E8F5E9; border: 1px solid #2E7D32;">
                        <span style="font-size: 16px; font-weight: 700; color: #2E7D32;" id="txt-saving-amt">0 ‡∏ø</span>
                    </div>
                </div>
                <div class="stat-box">
                    <div style="font-weight: 600; font-size: 14px;">‡∏ü‡∏∏‡πà‡∏°‡πÄ‡∏ü‡∏∑‡∏≠‡∏¢</div>
                    <div class="stat-value-box" style="background: #FFEBEE; border: 1px solid #C62828;">
                        <span style="font-size: 16px; font-weight: 700; color: #C62828;" id="txt-wasteful-amt">0 ‡∏ø</span>
                    </div>
                </div>
            </div>
        </section>

        <section id="page-add" class="page">
            <div class="header">
                <h2><button class="back-btn clickable" onclick="goToPage('page-home')"><i class="fas fa-arrow-left"></i></button> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏¢‡∏≠‡∏î‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</h2>
            </div>
            
            <div class="card-white" style="margin-top: 10px; padding: 25px 20px;">
                <p style="margin: 0; font-size: 14px; font-weight: 500;">‡∏û‡∏¥‡∏°‡∏û‡πå‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡∏à‡∏∞‡∏™‡∏±‡πà‡∏á‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏Å‡πá‡πÑ‡∏î‡πâ‡∏ô‡∏∞!</p>
                <img src="2.jpg" style="width: 60px; height: 60px; border-radius: 50%; position: absolute; right: 10px; top: -20px; border: var(--border-solid); background: white; object-fit: cover;">
            </div>

            <div class="card-transparent">
                <div class="auth-label" style="font-size: 14px; margin-bottom: 5px;">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏à‡πà‡∏≤‡∏¢ (‡∏ö‡∏≤‡∏ó)</div>
                <input type="number" class="input-box" id="inp-amount" placeholder="0" style="text-align: left; padding: 14px 15px;">
                
                <div class="auth-label" style="font-size: 14px; margin-bottom: 5px;">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢</div>
                <input type="text" class="input-box" id="inp-note" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Ñ‡πà‡∏≤‡∏Ç‡πâ‡∏≤‡∏ß, ‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡πÅ‡∏ü" style="padding: 14px 15px;">
                
                <button class="btn clickable" id="btn-mic" onclick="startVoiceRecognition()" style="background: var(--bg-card); border: 2px dashed var(--btn-confirm); width: 100%; color: var(--btn-confirm); display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 15px; font-weight: 500; padding: 14px;">
                    <i class="fas fa-microphone"></i> ‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏û‡∏π‡∏î (‡πÄ‡∏ä‡πà‡∏ô "‡∏Å‡∏¥‡∏ô‡∏Ç‡πâ‡∏≤‡∏ß 50 ‡∏ö‡∏≤‡∏ó")
                </button>
                
                <button class="btn clickable" style="background: var(--c-bar-4); color: #131211; width: 100%; font-size: 16px; padding: 15px; border-radius: 12px; border: var(--border-solid);" onclick="actionSaveExpense()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</button>
            </div>
        </section>

        <section id="page-history" class="page">
            <div class="header">
                <h2><button class="back-btn clickable" onclick="goToPage('page-home')"><i class="fas fa-arrow-left"></i></button> ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</h2>
                <i class="far fa-bell clickable" style="font-size: 20px;"></i>
            </div>
            
            <div style="display: flex; gap: 15px; margin-bottom: 30px; margin-top: 10px; position: relative;">
                <div style="flex: 1; background: var(--bg-register); border-radius: 15px; padding: 15px; text-align: center; border: var(--border-solid);">
                    <div style="font-size: 14px; margin-bottom: 5px; font-weight: 500; color: #131211;">‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö</div>
                    <div style="font-weight: 700; font-size: 20px; color: #131211;">500 ‡∏ø</div>
                </div>
                <img id="may-mascot-history" src="1.jpg" style="height: 70px; position: absolute; top: -15px; left: 50%; transform: translateX(-50%); z-index: 2; object-fit: contain;">
                <div style="flex: 1; background: var(--bg-item-exp); border-radius: 15px; padding: 15px; text-align: center; border: var(--border-solid);">
                    <div style="font-size: 14px; margin-bottom: 5px; font-weight: 500; color: #131211;">‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</div>
                    <div style="font-weight: 700; font-size: 20px; color: #131211;" id="txt-total-exp">286 ‡∏ø</div>
                </div>
            </div>

            <div id="history-list">
                <div class="history-item item-exp clickable"><span style="color: #131211;"><i class="fas fa-train" style="width: 25px;"></i> BTS</span><span style="color: #131211;">-31</span></div>
                <div class="history-item item-exp clickable"><span style="color: #131211;"><i class="fas fa-coffee" style="width: 25px;"></i> amazon</span><span style="color: #131211;">-60</span></div>
                <div class="history-item item-exp clickable"><span style="color: #131211;"><i class="fas fa-shopping-cart" style="width: 25px;"></i> 7-Eleven</span><span style="color: #131211;">-39</span></div>
                <div class="history-item item-inc clickable"><span style="color: #131211;"><i class="fas fa-gift" style="width: 25px;"></i> ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏à‡∏≤‡∏Å mom</span><span style="color: #131211;">+500</span></div>
            </div>
        </section>

        <section id="page-profile" class="page">
            <div class="header">
                 <h2><button class="back-btn clickable" onclick="goToPage('page-home')"><i class="fas fa-arrow-left"></i></button> Profile</h2>
            </div>
            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid var(--text-sub);">
                <img class="user-avatar" src="" style="width: 70px; height: 70px; border-radius: 15px; border: var(--border-solid); background: white; object-fit: cover;">
                <div style="flex: 1;">
                    <div style="font-size: 12px; font-weight: 500;">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</div>
                    <input type="text" value="Maleeya Samaru" class="input-box" style="margin-bottom: 0; padding: 8px 12px;">
                </div>
            </div>
            <div class="auth-label">‡∏≠‡∏≤‡∏ä‡∏µ‡∏û</div>
            <input type="text" class="input-box" value="‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤">
            <div class="auth-label">‡∏ß‡∏±‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏õ‡∏µ‡πÄ‡∏Å‡∏¥‡∏î</div>
            <input type="text" class="input-box" value="01/01/2000">
            <div class="auth-label">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</div>
            <input type="text" class="input-box" value="088-888-8888">
            <div class="auth-label">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</div>
            <input type="text" class="input-box" value="maleeya@mail.com">
            
            <div style="text-align: center; margin-top: 10px;">
                <button class="btn clickable" style="background: var(--btn-grey); color: var(--text-main); width: 140px; display: block; margin: 0 auto; border: var(--border-solid); padding: 12px;" onclick="actionSaveProfile()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
            </div>
        </section>

        <section id="page-scan" class="page" style="padding: 0; background: var(--bg-main);">
             <div class="header" style="padding: 50px 20px 20px 20px; margin:0; z-index: 10; position: relative;">
                 <h2><button class="back-btn clickable" onclick="goToPage('page-home')"><i class="fas fa-arrow-left"></i></button> Scan</h2>
            </div>
             
             <div style="background: var(--bg-scan-area); flex: 1; width: 100%; position: relative; display: flex; align-items: center; justify-content: center; overflow: hidden; border-top: var(--border-solid); margin-bottom: 0;">
                 <div style="position: absolute; top: 15%; left: 15%; width: 40px; height: 40px; border-top: 4px solid #131211; border-left: 4px solid #131211;"></div>
                 <div style="position: absolute; top: 15%; right: 15%; width: 40px; height: 40px; border-top: 4px solid #131211; border-right: 4px solid #131211;"></div>
                 <div style="position: absolute; bottom: 30%; left: 15%; width: 40px; height: 40px; border-bottom: 4px solid #131211; border-left: 4px solid #131211;"></div>
                 <div style="position: absolute; bottom: 30%; right: 15%; width: 40px; height: 40px; border-bottom: 4px solid #131211; border-right: 4px solid #131211;"></div>
                 
                 <input type="file" id="receipt-upload" accept="image/*" style="display: none;" onchange="handleFileUpload(this)">
                 
                 <div class="clickable" onclick="document.getElementById('receipt-upload').click()" style="position: absolute; bottom: 25%; right: 15%; background: rgba(0,0,0,0.4); width: 40px; height: 40px; border-radius: 8px; display: flex; justify-content: center; align-items: center; z-index: 20;">
                     <i class="far fa-image" style="font-size: 20px; color: white;"></i>
                 </div>

                 <div id="scan-loading" class="scan-loading-text">
                     <i class="fas fa-spinner fa-spin" style="font-size: 30px; margin-bottom: 10px;"></i><br>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏î‡πâ‡∏ß‡∏¢ AI...
                 </div>
                 <div class="scan-line" id="laser-line"></div>
                 
                 <img src="1.jpg" style="height: 120px; position: absolute; bottom: -5px; right: 0px; object-fit: contain;">
             </div>
        </section>

        <section id="page-chat" class="page">
             <div class="header" style="border-bottom: 1px solid var(--text-sub); padding-bottom: 10px;">
                <h2><button class="back-btn clickable" onclick="goToPage('page-home')"><i class="fas fa-arrow-left"></i></button> ‡πÅ‡∏ä‡∏ó‡∏Å‡∏±‡∏ö‡πÄ‡∏°‡∏¢‡πå</h2>
            </div>
            <div style="flex: 1; overflow-y: auto; padding: 10px 0;" id="chat-history">
                <div style="text-align: center; color: var(--text-sub); font-size: 12px; margin-bottom: 20px;">--- ‡πÅ‡∏ä‡∏ó‡∏ô‡∏µ‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ AI ‡∏à‡∏£‡∏¥‡∏á‡πÅ‡∏•‡πâ‡∏ß ---</div>
            </div>
            <div style="background: var(--bg-main); padding: 10px 0; display: flex; gap: 10px; align-items: center;">
                <input type="text" id="chat-input" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ö‡πÄ‡∏°‡∏¢‡πå..." style="flex: 1; padding: 12px 20px; border-radius: 25px; border: var(--border-solid); background: var(--bg-card); color: var(--text-main); font-family: 'Prompt'; outline: none;">
                <button style="border: none; background: none; color: var(--btn-confirm);" class="clickable" onclick="sendMessage()">
                    <i class="fas fa-paper-plane" style="font-size: 24px;"></i>
                </button>
            </div>
        </section>

        <!-- === POPUPS === -->
        <div id="popup-confirm-expense" class="popup-overlay">
            <div class="popup-box">
                <div style="background: #E8F5E9; width: 70px; height: 70px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px;">
                    <i class="fas fa-exclamation-triangle" style="font-size: 35px; color: #2E7D32;"></i>
                </div>
                <h3 style="margin: 0; font-size: 18px; font-weight: 700;">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</h3>
                <p style="font-size: 13px; color: var(--text-sub); margin-bottom: 25px; margin-top: 5px;">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô <b id="confirm-amt-txt" style="color: var(--text-main);">0</b> ‡∏ø ‡∏Å‡πà‡∏≠‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</p>
                <div class="popup-btn-wrap">
                    <button class="btn-cancel clickable" onclick="closePopup('popup-confirm-expense')">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    <button class="btn-confirm clickable" onclick="processExpense()">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
                </div>
            </div>
        </div>

        <div id="popup-confirm-profile" class="popup-overlay">
            <div class="popup-box">
                <div style="background: #E8F5E9; width: 70px; height: 70px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px;">
                    <i class="fas fa-user-check" style="font-size: 35px; color: #2E7D32;"></i>
                </div>
                <h3 style="margin: 0; font-size: 18px; font-weight: 700;">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h3>
                <p style="font-size: 13px; color: var(--text-sub); margin-bottom: 25px; margin-top: 5px;">‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?</p>
                <div class="popup-btn-wrap">
                    <button class="btn-cancel clickable" onclick="closePopup('popup-confirm-profile')">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    <button class="btn-confirm clickable" onclick="processProfile()">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
                </div>
            </div>
        </div>

        <div id="popup-logout" class="popup-overlay">
            <div class="popup-box">
                <div style="background: #FFEBEE; width: 70px; height: 70px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px;">
                    <i class="fas fa-sign-out-alt" style="font-size: 35px; color: #C62828;"></i>
                </div>
                <h3 style="margin: 0; font-size: 18px; font-weight: 700;">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</h3>
                <p style="font-size: 13px; color: var(--text-sub); margin-bottom: 25px; margin-top: 5px;">‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡πÅ‡∏≠‡∏õ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?</p>
                <div class="popup-btn-wrap">
                    <button class="btn-cancel clickable" onclick="closePopup('popup-logout')">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    <button class="btn-confirm clickable" style="background: #EF4444;" onclick="goToPage('page-login'); closePopup('popup-logout');">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
                </div>
            </div>
        </div>

        <!-- Popup Reset Data -->
        <div id="popup-reset-data" class="popup-overlay">
            <div class="popup-box">
                <div style="background: #FFEBEE; width: 70px; height: 70px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px;">
                    <i class="fas fa-trash-alt" style="font-size: 35px; color: #C62828;"></i>
                </div>
                <h3 style="margin: 0; font-size: 18px; font-weight: 700;">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h3>
                <p style="font-size: 13px; color: var(--text-sub); margin-bottom: 25px; margin-top: 5px;">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥ ‡πÅ‡∏•‡∏∞‡∏Å‡∏£‡∏≤‡∏ü‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏î‡πâ</p>
                <div class="popup-btn-wrap">
                    <button class="btn-cancel clickable" onclick="closePopup('popup-reset-data')">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    <button class="btn-confirm clickable" style="background: #EF4444;" onclick="executeResetData()">‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                </div>
            </div>
        </div>

        <div id="popup-success" class="popup-overlay">
            <div class="popup-box">
                <i class="fas fa-check-circle" style="font-size: 60px; margin-bottom: 15px; color: #95D58C;"></i>
                <h3 style="margin: 0; font-size: 18px; font-weight: 700;">‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</h3>
                <div class="popup-btn-wrap" style="justify-content: center;">
                    <button class="btn-confirm clickable" style="width: 100%; border: var(--border-solid);" onclick="closePopup('popup-success');">‡∏ï‡∏Å‡∏•‡∏á</button>
                </div>
            </div>
        </div>

        <div id="popup-scan" class="popup-overlay">
            <div class="popup-box" style="background: var(--bg-scan-area); color: white; padding: 30px 20px; box-shadow: none;">
                <h3 style="margin-top: 0; font-size: 16px; font-weight: 500;">‡∏£‡∏∞‡∏ö‡∏ö‡∏°‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏´‡πá‡∏ô‡∏£‡∏≤‡∏Ñ‡∏≤‡πÉ‡∏ô‡∏£‡∏π‡∏õ</h3>
                <input type="number" id="scan-price" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏µ‡πà‡∏à‡πà‡∏≤‡∏¢‡πÑ‡∏õ" style="background: white; border: none; border-radius: 8px; padding: 12px; width: 100%; text-align: center; font-size: 16px; font-family: 'Prompt'; margin-bottom: 20px; font-weight: 600; outline: none; color: black; box-sizing: border-box;">
                <button class="btn-confirm clickable" style="width: 100%; background: #3B82F6;" onclick="finishScan()">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏≤‡∏Ñ‡∏≤</button>
            </div>
        </div>

        <div class="bottom-nav" id="main-nav">
            <div class="nav-item clickable" id="nav-profile" onclick="goToPage('page-profile')">
                <i class="far fa-user"></i> <span style="margin-top:2px;">Profile</span>
            </div>
            <div class="nav-center clickable" id="nav-middle" onclick="handleMiddleNavClick()">
                <i class="fas fa-home" id="icon-middle" style="font-size: 24px; margin-bottom: 2px;"></i> <span id="text-middle">Home</span>
            </div>
            <div class="nav-item clickable" id="nav-chat" onclick="goToPage('page-chat')">
            <i class="far fa-comment-dots"></i> <span style="margin-top:2px;">May</span>
        </div>
    </div>

    <!-- Sidebar Overlay & Menu -->
    <div class="sidebar-overlay" id="sidebar-overlay" onclick="closeSidebar()"></div>
    <div class="sidebar" id="sidebar-menu">
        <div class="sidebar-profile">
            <img class="user-avatar" src="" alt="User">
            <div class="name">Maleeya Samaru</div>
        </div>
        
        <div class="menu-item-container">
            <div class="menu-item clickable" onclick="goToPage('page-profile')">
                <div class="menu-item-left"><i class="far fa-user"></i> Profile</div>
                <i class="fas fa-chevron-right menu-item-arrow"></i>
            </div>
            <!-- === ‡∏à‡∏∏‡∏î‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ === -->
            <div class="menu-item clickable" onclick="goToPage('page-settings')">
                <div class="menu-item-left"><i class="fas fa-cog"></i> Setting</div>
                <i class="fas fa-chevron-right menu-item-arrow"></i>
            </div>
            <div class="menu-item clickable" onclick="goToPage('page-history')">
                <div class="menu-item-left">
                    <div style="border: 2px solid var(--text-main); width: 26px; height: 26px; display: flex; justify-content: center; align-items: center; border-radius: 4px; color: var(--text-main);">
                        <i class="fas fa-dollar-sign" style="font-size: 16px;"></i>
                    </div>
                    History
                </div>
                <i class="fas fa-chevron-right menu-item-arrow"></i>
            </div>
            <div class="menu-item clickable" onclick="goToPage('page-chat')">
                <div class="menu-item-left"><i class="far fa-calendar"></i> Chat May</div>
                <i class="fas fa-chevron-right menu-item-arrow"></i>
            </div>
            <div class="menu-item clickable" onclick="goToPage('page-scan')">
                <div class="menu-item-left"><i class="fas fa-sign-in-alt"></i> Scan</div>
                <i class="fas fa-chevron-right menu-item-arrow"></i>
            </div>
            <div class="menu-item clickable" onclick="closeSidebar(); showPopup('popup-logout');">
                <div class="menu-item-left" style="color: #EF4444;"><i class="fas fa-sign-out-alt"></i> Logout</div>
                <i class="fas fa-chevron-right menu-item-arrow" style="color: #EF4444;"></i>
            </div>
        </div>
    </div>

</div>

<script>
        const apiKey = "AIzaSyCtniJE8HjlMfFWW_E3wkdsD4VvTTT771I"; 
        const geminiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${apiKey}`;

        // ==========================================
        // üé® ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ (‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì)
        // ==========================================
        const APP_IMAGES = {
            userAvatar: "2.jpg", // ‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå (‡∏£‡∏π‡∏õ‡∏ô‡πâ‡∏≠‡∏á‡πÅ‡∏ß‡πà‡∏ô‡∏ô‡∏±‡πà‡∏á 2.jpg)
            mascotNormal: "1.jpg", // ‡∏£‡∏π‡∏õ‡πÄ‡∏°‡∏™‡∏Ñ‡∏≠‡∏ï‡∏õ‡∏Å‡∏ï‡∏¥ (‡∏£‡∏π‡∏õ‡∏¢‡∏∑‡∏ô 1.jpg)
            mascotHappy: "3.jpg",  // ‡∏£‡∏π‡∏õ‡∏ï‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏¢‡∏≠‡∏∞ (‡∏£‡∏π‡∏õ‡∏¢‡∏∑‡∏ô 3.jpg)
            mascotSad: "4.jpg",    // ‡∏£‡∏π‡∏õ‡∏ï‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏ô‡πâ‡∏≠‡∏¢ (‡∏£‡∏π‡∏õ‡∏ô‡∏±‡πà‡∏á 4.jpg)
            mascotShocked: "4.jpg" // ‡∏£‡∏π‡∏õ‡∏ï‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡∏¥‡∏î‡∏•‡∏ö (‡∏£‡∏π‡∏õ‡∏ô‡∏±‡πà‡∏á 4.jpg)
        };

        // Data State ‡∏Ç‡∏≠‡∏á‡πÅ‡∏≠‡∏õ
        let state = { 
            budget: 500, 
            expense: 286, 
            balance: 214, 
            saving: 674,     
            wasteful: 184,   
            chartData: [369, 335, 301, 341, 324, 350, 214] 
        };
        let currentPage = '';
        let isDarkMode = false; // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÇ‡∏´‡∏°‡∏î‡∏Å‡∏•‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô

        document.querySelectorAll('.user-avatar').forEach(img => img.src = APP_IMAGES.userAvatar);

        setInterval(() => {
            const now = new Date();
            document.querySelectorAll('.status-bar span').forEach(el => el.innerText = now.toLocaleTimeString('th-TH', { hour: '2-digit', minute: '2-digit' }));
        }, 1000);

        function vibrate(pattern) {
            if (navigator.vibrate) navigator.vibrate(pattern);
        }

        function handleMiddleNavClick() {
            vibrate(30);
            if (currentPage === 'page-home') { goToPage('page-scan'); } 
            else { goToPage('page-home'); }
        }

        function openSidebar() {
            document.getElementById('sidebar-overlay').style.display = 'block';
            setTimeout(() => {
                document.getElementById('sidebar-overlay').style.opacity = '1';
                document.getElementById('sidebar-menu').classList.add('open');
            }, 10);
            vibrate(30);
        }

        function closeSidebar() {
            document.getElementById('sidebar-overlay').style.opacity = '0';
            document.getElementById('sidebar-menu').classList.remove('open');
            setTimeout(() => {
                document.getElementById('sidebar-overlay').style.display = 'none';
            }, 300);
        }

        function goToAuth(type) {
            if(type === 'login') {
                document.getElementById('tab-login-btn').style.background = 'var(--bg-login)';
                document.getElementById('tab-login-btn').style.opacity = '1';
                document.getElementById('tab-register-btn').style.background = 'var(--bg-register)';
                document.getElementById('tab-register-btn').style.opacity = '0.6';
                document.getElementById('auth-box').style.background = 'var(--bg-login)';
                document.getElementById('form-login').style.display = 'block'; 
                document.getElementById('form-register').style.display = 'none';
            } else {
                document.getElementById('tab-login-btn').style.background = 'var(--bg-login)';
                document.getElementById('tab-login-btn').style.opacity = '0.6';
                document.getElementById('tab-register-btn').style.background = 'var(--bg-register)';
                document.getElementById('tab-register-btn').style.opacity = '1';
                document.getElementById('auth-box').style.background = 'var(--bg-register)';
                document.getElementById('form-login').style.display = 'none'; 
                document.getElementById('form-register').style.display = 'block';
            }
        }

        function goToPage(pageId) {
            if (currentPage === pageId) return; 
            currentPage = pageId;
            
            closeSidebar(); 
            
            document.querySelectorAll('.page').forEach(p => { 
                p.style.display = 'none'; p.classList.remove('active'); 
            });
            
            const target = document.getElementById(pageId);
            if (target) {
                target.style.display = 'flex'; 
                void target.offsetWidth; 
                target.classList.add('active'); 
            }

            const nav = document.getElementById('main-nav');
            if(pageId === 'page-login' || pageId === 'page-scan') {
                nav.style.display = "none";
            } else {
                nav.style.display = "flex";
                updateNavState(pageId);
            }

            if(pageId === 'page-home') updateHomeUI();
            if(pageId === 'page-history') document.getElementById('txt-total-exp').innerText = state.expense.toLocaleString() + ' ‡∏ø';
            if(pageId === 'page-summary') { 
                document.getElementById('txt-summary-bal').innerText = state.balance.toLocaleString(); 
                document.getElementById('txt-saving-amt').innerText = state.saving.toLocaleString() + ' ‡∏ø';
                document.getElementById('txt-wasteful-amt').innerText = state.wasteful.toLocaleString() + ' ‡∏ø';
                renderChart(); 
            }
            if(pageId === 'page-add' || pageId === 'page-home') updateMascotImages();
        }

        function updateNavState(pageId) {
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active-nav'));
            const midTab = document.getElementById('nav-middle');
            const midIcon = document.getElementById('icon-middle');
            const midText = document.getElementById('text-middle');

            if(pageId === 'page-home') {
                midIcon.className = 'fas fa-expand'; midText.innerText = 'scan'; midTab.className = 'nav-center scan-mode';
            } else {
                midIcon.className = 'fas fa-home'; midText.innerText = 'Home'; midTab.className = 'nav-center';
            }

            if(pageId === 'page-profile') document.getElementById('nav-profile').classList.add('active-nav');
            if(pageId === 'page-chat') document.getElementById('nav-chat').classList.add('active-nav');
        }

        function updateMascotImages() {
            let percent = (state.balance / state.budget) * 100;
            let currentEmotion = APP_IMAGES.mascotNormal;
            let msg = "‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ ‡πÄ‡∏£‡∏≤‡πÄ‡∏°‡∏¢‡πå‡∏ô‡∏∞ <br> ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏≠‡∏≠‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á";
            
            if (percent > 70) { currentEmotion = APP_IMAGES.mascotHappy; msg = "‡∏™‡∏∏‡∏î‡∏¢‡∏≠‡∏î‡πÄ‡∏•‡∏¢!<br>‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Å‡πà‡∏á‡∏°‡∏≤‡∏Å‡∏ô‡∏≤‡∏¢‡∏ó‡πà‡∏≤‡∏ô üéâ"; } 
            else if (percent > 30) { currentEmotion = APP_IMAGES.mascotNormal; } 
            else if (percent > 0) { currentEmotion = APP_IMAGES.mascotSad; msg = "‡πÅ‡∏á‡∏á‡∏á ‡πÄ‡∏á‡∏¥‡∏ô‡∏à‡∏∞‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß‡∏ô‡∏∞<br>‡∏£‡∏∞‡∏ß‡∏±‡∏á‡∏´‡∏ô‡πà‡∏≠‡∏¢‡∏™‡∏¥ üò≠"; } 
            else { currentEmotion = APP_IMAGES.mascotShocked; msg = "‡∏ä‡πá‡∏≠‡∏ï‡πÅ‡∏•‡πâ‡∏ß‡∏à‡πâ‡∏≤‡∏≤‡∏≤!<br>‡∏ï‡∏¥‡∏î‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß‡∏ô‡∏∞ ‡∏Å‡∏¥‡∏ô‡∏°‡∏≤‡∏°‡πà‡∏≤‡∏î‡πà‡∏ß‡∏ô üö®"; }

            if(document.getElementById('may-mascot-home')) {
                document.getElementById('may-mascot-home').src = currentEmotion;
                document.getElementById('mey-home-msg').innerHTML = msg;
            }
            if(document.getElementById('may-mascot-history')) document.getElementById('may-mascot-history').src = currentEmotion;
        }

        function updateHomeUI() {
            document.getElementById('txt-balance').innerText = state.balance.toLocaleString();
            document.getElementById('txt-budget').innerText = state.budget.toLocaleString();
            let percent = (state.balance / state.budget) * 100;
            
            let gaugeColor = "#8AC48A"; 
            let emptyColor = "var(--bg-register)"; 
            if(percent < 30) { gaugeColor = "var(--c-bar-5)"; emptyColor = "#FCE6D0"; } 
            if(percent <= 0) { gaugeColor = "var(--c-bar-1)"; emptyColor = "#FAD4D4"; } 
            
            if(isDarkMode) {
                if(percent >= 30) emptyColor = "#276749"; // Dark green for empty ring in dark mode
                if(percent < 30) emptyColor = "#7B341E";
                if(percent <= 0) emptyColor = "#742A2A";
            }
            
            document.getElementById('home-gauge').style.background = `conic-gradient(${gaugeColor} ${Math.max(0,Math.min(percent,100))}%, ${emptyColor} 0)`;
        }

        function renderChart() {
            const container = document.getElementById('chart-area'); 
            container.innerHTML = ''; 
            const days = ['‡∏≠‡∏≤.', '‡∏à.', '‡∏≠.', '‡∏û.', '‡∏û‡∏§.', '‡∏®.', '‡∏™.'];
            const colors = ['var(--c-bar-1)', 'var(--c-bar-2)', 'var(--c-bar-3)', 'var(--c-bar-4)', 'var(--c-bar-5)', 'var(--c-bar-6)', 'var(--c-bar-7)'];
            const maxVal = Math.max(...state.chartData, 500);
            
            state.chartData.forEach((val, index) => {
                const heightPercent = (val / maxVal) * 80; 
                const group = document.createElement('div'); 
                group.className = 'bar-group';
                group.innerHTML = `
                    <div style="font-size: 9px; font-weight:600; margin-bottom: 2px;">${val}</div>
                    <div class="bar" style="background: ${colors[index]}; border: 1px solid #131211;"></div>
                    <div class="bar-label">${days[index]}</div>
                `;
                container.appendChild(group);
                setTimeout(() => { group.querySelector('.bar').style.height = heightPercent + '%'; }, 100 * index + 100); 
            });
        }

        function fireConfetti() {
            const colors = ['#90CD8B', '#85ACFB', '#FBD88B', '#FB8B8B', '#A25CE0'];
            for (let i = 0; i < 30; i++) {
                let conf = document.createElement('div'); conf.className = 'confetti';
                conf.style.left = Math.random() * 100 + 'vw';
                conf.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                conf.style.animationDuration = (Math.random() * 1 + 1) + 's';
                conf.style.animationDelay = (Math.random() * 0.5) + 's';
                document.body.appendChild(conf);
                setTimeout(() => conf.remove(), 2000);
            }
        }

        function showPopup(id) { document.getElementById(id).style.display = 'flex'; }
        function closePopup(id) { document.getElementById(id).style.display = 'none'; }

        function actionSaveExpense() {
            const amt = document.getElementById('inp-amount').value;
            if(!amt || amt <= 0) { alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏à‡πà‡∏≤‡∏¢‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö'); return; }
            vibrate(50);
            
            window.tempTx = { amount: parseInt(amt), name: document.getElementById('inp-note').value || '‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ' };
            document.getElementById('confirm-amt-txt').innerText = amt;
            showPopup('popup-confirm-expense');
        }

        function processExpense() {
            const tx = window.tempTx; 
            state.balance -= tx.amount; 
            state.expense += tx.amount; 
            state.chartData[6] += tx.amount; 
            
            state.wasteful += Math.floor(tx.amount * 0.4); 
            state.saving -= Math.floor(tx.amount * 0.1); 
            
            // ‡πÉ‡∏ä‡πâ style inline ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏µ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏™‡∏≠‡∏î‡∏Ñ‡∏•‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡∏ò‡∏µ‡∏°‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏°‡∏≤
            let textColor = isDarkMode ? "#F7FAFC" : "#131211";
            document.getElementById('history-list').insertAdjacentHTML('afterbegin', `<div class="history-item item-exp clickable"><span style="color: ${textColor};"><i class="fas fa-shopping-cart" style="width: 25px;"></i> ${tx.name}</span><span style="color: ${textColor};">-${tx.amount}</span></div>`);
            
            closePopup('popup-confirm-expense'); 
            document.getElementById('inp-amount').value = ''; document.getElementById('inp-note').value = '';
            showPopup('popup-success');
            fireConfetti(); vibrate([100, 50, 100]); 
            updateHomeUI(); 
        }

        function actionSaveProfile() {
            vibrate(50);
            showPopup('popup-confirm-profile');
        }

        function processProfile() {
            closePopup('popup-confirm-profile');
            showPopup('popup-success');
            fireConfetti(); vibrate([100, 50, 100]); 
        }

        // ==========================================
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ (Settings)
        // ==========================================
        function toggleTheme() {
            isDarkMode = !isDarkMode;
            const appFrame = document.getElementById('app-frame');
            const toggleBtn = document.getElementById('toggle-dark-mode');

            if(isDarkMode) {
                appFrame.classList.add('dark-mode');
                toggleBtn.classList.add('active');
            } else {
                appFrame.classList.remove('dark-mode');
                toggleBtn.classList.remove('active');
            }
            vibrate(30);
            if(currentPage === 'page-home') updateHomeUI(); // Update ring color
        }

        function executeResetData() {
            // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ñ‡πà‡∏≤‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            state = {
                budget: 500,
                expense: 0,
                balance: 500,
                saving: 0,
                wasteful: 0,
                chartData: [0, 0, 0, 0, 0, 0, 0]
            };

            // ‡∏•‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥
            document.getElementById('history-list').innerHTML = `<div style="text-align:center; padding: 30px 20px; color: var(--text-sub); font-size: 14px;">‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢<br>‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏á‡∏¥‡∏ô‡∏Å‡∏±‡∏ô‡πÄ‡∏ñ‡∏≠‡∏∞!</div>`;

            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI ‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡πÜ ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏Ñ‡πà‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏ï‡πâ‡∏ô
            updateHomeUI();
            updateMascotImages();
            document.getElementById('txt-total-exp').innerText = '0 ‡∏ø';
            
            if(currentPage === 'page-summary') {
                document.getElementById('txt-summary-bal').innerText = '500';
                document.getElementById('txt-saving-amt').innerText = '0 ‡∏ø';
                document.getElementById('txt-wasteful-amt').innerText = '0 ‡∏ø';
                renderChart();
            }

            closePopup('popup-reset-data');
            showPopup('popup-success');
            vibrate([100, 50, 100]);
            
            // ‡πÄ‡∏î‡πâ‡∏á‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤ Home ‡πÉ‡∏´‡πâ‡πÄ‡∏´‡πá‡∏ô‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
            setTimeout(() => { goToPage('page-home'); }, 1000);
        }
        // ==========================================

        function startVoiceRecognition() {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (!SpeechRecognition) { alert("‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏±‡πà‡∏á‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏Ñ‡∏£‡∏±‡∏ö"); return; }
            const recognition = new SpeechRecognition();
            recognition.lang = 'th-TH'; 
            const btnMic = document.getElementById('btn-mic');
            recognition.onstart = function() {
                vibrate(50); btnMic.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ü‡∏±‡∏á... ‡∏û‡∏π‡∏î‡πÄ‡∏•‡∏¢!'; btnMic.style.borderColor = 'var(--c-red)'; btnMic.style.color = 'var(--c-red)';
            };
            recognition.onresult = function(event) {
                const transcript = event.results[0][0].transcript;
                const numberMatch = transcript.match(/\d+/);
                if (numberMatch) {
                    document.getElementById('inp-amount').value = numberMatch[0];
                    let note = transcript.replace(numberMatch[0], '').replace('‡∏ö‡∏≤‡∏ó', '').replace('‡∏£‡∏≤‡∏Ñ‡∏≤', '').trim();
                    document.getElementById('inp-note').value = note || "‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢";
                    vibrate([50, 50]); 
                } else { alert('‡∏´‡∏≤‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠‡∏Ñ‡∏£‡∏±‡∏ö ‡∏•‡∏≠‡∏á‡∏û‡∏π‡∏î‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏ó‡∏µ‡∏ô‡∏∞'); }
            };
            recognition.onend = function() {
                btnMic.innerHTML = '<i class="fas fa-microphone"></i> ‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏û‡∏π‡∏î (‡πÄ‡∏ä‡πà‡∏ô "‡∏Å‡∏¥‡∏ô‡∏Ç‡πâ‡∏≤‡∏ß 50 ‡∏ö‡∏≤‡∏ó")'; btnMic.style.borderColor = 'var(--border-solid)'; btnMic.style.color = 'var(--btn-confirm)';
            };
            recognition.start();
        }

        async function callGeminiAPI(promptText, imageBase64 = null, isJson = false) {
            let parts = [{ text: promptText }];
            if (imageBase64) {
                const base64Data = imageBase64.split(',')[1] || imageBase64;
                parts.push({ inlineData: { mimeType: "image/jpeg", data: base64Data } });
            }

            const payload = { contents: [{ parts: parts }] };
            if(isJson) payload.generationConfig = { responseMimeType: "application/json" };

            try {
                const response = await fetch(geminiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                const data = await response.json();
                return data.candidates[0].content.parts[0].text;
            } catch (error) {
                console.error("Gemini Error:", error);
                return null;
            }
        }

        function handleFileUpload(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                document.getElementById('scan-loading').style.display = 'block';
                document.getElementById('laser-line').style.display = 'none';

                reader.onload = async function(e) {
                    const base64Image = e.target.result;
                    const prompt = "Analyze this receipt image. Extract the Merchant Name and the Total Amount. Return ONLY a JSON object with keys: 'merchant' (string) and 'amount' (number). If you cannot find them, return null.";
                    
                    try {
                        const jsonString = await callGeminiAPI(prompt, base64Image, true);
                        const data = JSON.parse(jsonString);

                        if (data && data.amount) {
                            document.getElementById('inp-amount').value = data.amount;
                            document.getElementById('inp-note').value = data.merchant || "‡∏™‡πÅ‡∏Å‡∏ô‡∏ö‡∏¥‡∏•";
                            document.getElementById('scan-loading').style.display = 'none';
                            document.getElementById('laser-line').style.display = 'block';
                            input.value = ''; goToPage('page-add'); vibrate([50, 50]);
                        } else { throw new Error("No data"); }
                    } catch (err) {
                        document.getElementById('scan-loading').style.display = 'none';
                        document.getElementById('laser-line').style.display = 'block';
                        showPopup('popup-scan'); vibrate(50);
                    }
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        function finishScan() {
            const price = document.getElementById('scan-price').value;
            if(price) {
                document.getElementById('inp-amount').value = price;
                document.getElementById('scan-price').value = '';
                closePopup('popup-scan');
                goToPage('page-add');
            } else { alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡πÑ‡∏õ‡∏ï‡πà‡∏≠‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö'); }
        }

        async function sendMessage() {
            const inp = document.getElementById('chat-input'); 
            const msg = inp.value; if(!msg) return;
            const box = document.getElementById('chat-history');
            
            box.insertAdjacentHTML('beforeend', `<div style="margin-bottom: 15px; text-align: right;"><div style="background: var(--btn-confirm); color: white; padding: 10px 15px; border-radius: 15px 15px 0 15px; display: inline-block; max-width: 80%; font-size: 14px; text-align: left; border: var(--border-solid);">${msg}</div></div>`);
            inp.value = ''; box.scrollTop = box.scrollHeight;
            
            const loadId = 'load-' + Date.now();
            box.insertAdjacentHTML('beforeend', `<div id="${loadId}" style="margin-bottom: 15px; display: flex; align-items: flex-start; gap: 10px;"><img src="${APP_IMAGES.userAvatar}" style="width: 35px; border-radius: 50%; border: var(--border-solid); background: white; object-fit: cover;"><div><span style="font-size: 12px; font-weight: 600;">May</span><div style="background: var(--bg-card); color: var(--text-main); border: var(--border-solid); padding: 10px 15px; border-radius: 0 15px 15px 15px; font-size: 14px; margin-top: 5px;"><i class="fas fa-ellipsis-h fa-fade"></i></div></div></div>`);
            box.scrollTop = box.scrollHeight;

            const systemPrompt = `You are 'May', a cute, slightly sassy Thai financial assistant mascot. 
            User's current budget: ${state.budget} Baht.
            User's current expense: ${state.expense} Baht.
            User's balance: ${state.balance} Baht.
            Reply in Thai, keep it short (1-2 sentences), and use emojis. Be encouraging but warn if balance is low.
            User asks: "${msg}"`;

            const reply = await callGeminiAPI(systemPrompt);
            document.getElementById(loadId).remove();

            if(reply) {
                box.insertAdjacentHTML('beforeend', `<div style="margin-bottom: 15px; display: flex; align-items: flex-start; gap: 10px;"><img src="${APP_IMAGES.userAvatar}" style="width: 35px; border-radius: 50%; border: var(--border-solid); background: white; object-fit: cover;"><div><span style="font-size: 12px; font-weight: 600;">May</span><div style="background: var(--bg-card); color: var(--text-main); border: var(--border-solid); padding: 10px 15px; border-radius: 0 15px 15px 15px; font-size: 14px; margin-top: 5px;">${reply}</div></div></div>`);
                vibrate(50);
            } else {
                box.insertAdjacentHTML('beforeend', `<div style="margin-bottom: 15px; display: flex; align-items: flex-start; gap: 10px;"><img src="${APP_IMAGES.userAvatar}" style="width: 35px; border-radius: 50%; border: var(--border-solid); background: white; object-fit: cover;"><div><span style="font-size: 12px; font-weight: 600;">May</span><div style="background: var(--bg-card); color: var(--text-main); border: var(--border-solid); padding: 10px 15px; border-radius: 0 15px 15px 15px; font-size: 14px; margin-top: 5px;">‡∏Ç‡∏≠‡∏≠‡∏†‡∏±‡∏¢ ‡πÄ‡∏°‡∏¢‡πå‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡πÑ‡∏°‡πà‡∏ó‡∏±‡∏ô ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏ô‡∏∞!</div></div></div>`);
            }
            box.scrollTop = box.scrollHeight;
        }
        
        window.onload = () => { goToPage('page-login'); };
    </script>
</body>
</html>